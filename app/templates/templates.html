{% extends "base.html" %} {% block title %}ููุงูุจ ุงูุฑุณุงุฆู - RoboVAI{% endblock %}
{% block content %}
<div class="grid lg:grid-cols-3 gap-6 fade-in">
  <!-- Main Content -->
  <div class="lg:col-span-2 space-y-6">
    <div class="glass-card p-6">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h1 class="text-2xl font-bold text-slate-50">๐ ููุงูุจ ุงูุฑุณุงุฆู</h1>
          <p class="text-slate-400 text-sm mt-1">
            ุฑุณุงุฆู ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ุงูุณุฑูุน
          </p>
        </div>
      </div>

      <!-- Tenant & Category Selector -->
      <div class="grid md:grid-cols-2 gap-4 mb-6">
        <div>
          <label class="label">ุงุฎุชุฑ ุงููุดุฑูุน</label>
          <select
            id="tenant_select"
            class="select-field"
            onchange="loadTemplates()"
          >
            <option value="">-- ุงุฎุชุฑ ูุดุฑูุนุงู --</option>
            {% for tenant in tenants %}
            <option value="{{ tenant.id }}">{{ tenant.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="label">ุงูุชุตููู</label>
          <select
            id="category_filter"
            class="select-field"
            onchange="loadTemplates()"
          >
            <option value="">ุฌููุน ุงูุชุตูููุงุช</option>
            <option value="welcome">๐ ุชุฑุญูุจ</option>
            <option value="farewell">๐ ูุฏุงุน</option>
            <option value="complaint">๐ ุดูุงูู</option>
            <option value="inquiry">โ ุงุณุชูุณุงุฑุงุช</option>
            <option value="promotion">๐ ุนุฑูุถ</option>
            <option value="support">๐ง ุฏุนู ููู</option>
            <option value="payment">๐ณ ุฏูุน</option>
            <option value="shipping">๐ฆ ุดุญู</option>
            <option value="general">๐ ุนุงู</option>
          </select>
        </div>
      </div>

      <!-- Templates List -->
      <div id="templates-list">
        <div class="text-center py-12 text-slate-400">
          <div class="text-5xl mb-4">๐</div>
          <p>ุงุฎุชุฑ ูุดุฑูุนุงู ูุนุฑุถ ุงูููุงูุจ</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="space-y-6">
    <!-- Add New Template -->
    <div class="glass-card p-6">
      <h3 class="font-semibold text-slate-50 mb-4">โ ุฅุถุงูุฉ ูุงูุจ ุฌุฏูุฏ</h3>
      <form id="add-template-form" onsubmit="addTemplate(event)">
        <div class="space-y-4">
          <div>
            <label class="label">ุงุณู ุงููุงูุจ</label>
            <input
              type="text"
              id="new_name"
              class="input-field"
              placeholder="ูุซุงู: ุชุฑุญูุจ ุนุงู"
              required
            />
          </div>
          <div>
            <label class="label">ุงูุชุตููู</label>
            <select id="new_category" class="select-field" required>
              <option value="welcome">๐ ุชุฑุญูุจ</option>
              <option value="farewell">๐ ูุฏุงุน</option>
              <option value="complaint">๐ ุดูุงูู</option>
              <option value="inquiry">โ ุงุณุชูุณุงุฑุงุช</option>
              <option value="promotion">๐ ุนุฑูุถ</option>
              <option value="support">๐ง ุฏุนู ููู</option>
              <option value="payment">๐ณ ุฏูุน</option>
              <option value="shipping">๐ฆ ุดุญู</option>
              <option value="general" selected>๐ ุนุงู</option>
            </select>
          </div>
          <div>
            <label class="label">ูุญุชูู ุงูุฑุณุงูุฉ</label>
            <textarea
              id="new_content"
              class="input-field"
              rows="4"
              placeholder="ุงูุชุจ ูุต ุงูุฑุณุงูุฉ ููุง..."
              required
            ></textarea>
            <p class="text-xs text-slate-500 mt-1">
              ููููู ุงุณุชุฎุฏุงู ูุชุบูุฑุงุช ูุซู {customer_name}
            </p>
          </div>
          <div>
            <label class="label">ุงููุชุบูุฑุงุช (ุงุฎุชูุงุฑู)</label>
            <input
              type="text"
              id="new_variables"
              class="input-field"
              placeholder="customer_name,order_id"
            />
            <p class="text-xs text-slate-500 mt-1">ุงูุตู ุจูู ุงููุชุบูุฑุงุช ุจูุงุตูุฉ</p>
          </div>
          <button type="submit" class="btn-primary w-full" id="add-btn">
            โ ุฅุถุงูุฉ ุงููุงูุจ
          </button>
        </div>
      </form>
    </div>

    <!-- Quick Actions -->
    <div class="glass-card p-6">
      <h3 class="font-semibold text-slate-50 mb-4">โก ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ</h3>
      <div class="space-y-3">
        <button
          onclick="seedDefaultTemplates()"
          class="w-full py-3 px-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all text-sm font-medium"
        >
          ๐ ุฅุถุงูุฉ ููุงูุจ ุงูุชุฑุงุถูุฉ
        </button>
        <p class="text-xs text-slate-400 text-center">
          ูุถูู 13 ูุงูุจ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
        </p>
      </div>
    </div>

    <!-- Categories Info -->
    <div class="glass-card p-6">
      <h3 class="font-semibold text-slate-50 mb-4">๐ ุฏููู ุงูุชุตูููุงุช</h3>
      <div class="space-y-2 text-sm">
        <div class="flex items-center gap-2 text-slate-300">
          <span>๐</span> <strong>ุชุฑุญูุจ:</strong> ุฑุณุงุฆู ุงูุงุณุชูุจุงู
        </div>
        <div class="flex items-center gap-2 text-slate-300">
          <span>๐</span> <strong>ุดูุงูู:</strong> ุงูุชุนุงูู ูุน ุงููุดุงูู
        </div>
        <div class="flex items-center gap-2 text-slate-300">
          <span>๐</span> <strong>ุนุฑูุถ:</strong> ุงูุนุฑูุถ ูุงูุฎุตููุงุช
        </div>
        <div class="flex items-center gap-2 text-slate-300">
          <span>๐ง</span> <strong>ุฏุนู:</strong> ุงููุณุงุนุฏุฉ ุงูุชูููุฉ
        </div>
        <div class="flex items-center gap-2 text-slate-300">
          <span>๐ณ</span> <strong>ุฏูุน:</strong> ุงููุนุงููุงุช ุงููุงููุฉ
        </div>
        <div class="flex items-center gap-2 text-slate-300">
          <span>๐ฆ</span> <strong>ุดุญู:</strong> ุงูุชูุตูู ูุงูุชุชุจุน
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function loadTemplates() {
    const tenantId = document.getElementById('tenant_select').value;
    const category = document.getElementById('category_filter').value;

    if (!tenantId) {
      document.getElementById('templates-list').innerHTML = `
            <div class="text-center py-12 text-slate-400">
                <div class="text-5xl mb-4">๐</div>
                <p>ุงุฎุชุฑ ูุดุฑูุนุงู ูุนุฑุถ ุงูููุงูุจ</p>
            </div>
        `;
      return;
    }

    let url = '/ui/templates/list?tenant_id=' + tenantId;
    if (category) url += '&category=' + category;

    htmx.ajax('GET', url, { target: '#templates-list' });
  }

  function addTemplate(e) {
    e.preventDefault();

    const tenantId = document.getElementById('tenant_select').value;
    if (!tenantId) {
      alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุดุฑูุน ุฃููุงู');
      return;
    }

    const formData = new FormData();
    formData.append('tenant_id', tenantId);
    formData.append('name', document.getElementById('new_name').value);
    formData.append('category', document.getElementById('new_category').value);
    formData.append('content', document.getElementById('new_content').value);
    formData.append(
      'variables',
      document.getElementById('new_variables').value
    );

    fetch('/ui/templates/add', {
      method: 'POST',
      body: formData,
    })
      .then((response) => response.text())
      .then((html) => {
        document.getElementById('templates-list').innerHTML = html;
        document.getElementById('add-template-form').reset();
      });
  }

  function copyTemplate(content) {
    navigator.clipboard.writeText(content).then(() => {
      // Show toast
      const toast = document.createElement('div');
      toast.className =
        'fixed bottom-4 left-4 bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg slide-in z-50';
      toast.innerHTML = 'โ ุชู ูุณุฎ ุงููุงูุจ!';
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    });
  }

  function deleteTemplate(templateId) {
    if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงููุงูุจุ')) return;

    const tenantId = document.getElementById('tenant_select').value;

    fetch('/ui/templates/delete', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: 'template_id=' + templateId + '&tenant_id=' + tenantId,
    })
      .then((response) => response.text())
      .then((html) => {
        document.getElementById('templates-list').innerHTML = html;
      });
  }

  function seedDefaultTemplates() {
    const tenantId = document.getElementById('tenant_select').value;
    if (!tenantId) {
      alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุดุฑูุน ุฃููุงู');
      return;
    }

    if (!confirm('ุณูุชู ุฅุถุงูุฉ 13 ูุงูุจ ุงูุชุฑุงุถู. ูุชุงุจุนุฉุ')) return;

    fetch('/ui/templates/seed', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: 'tenant_id=' + tenantId,
    })
      .then((response) => response.text())
      .then((html) => {
        document.getElementById('templates-list').innerHTML = html;
      });
  }
</script>
{% endblock %}
