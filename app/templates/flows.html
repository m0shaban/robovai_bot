{% extends "base.html" %} {% block content %}
<div class="max-w-7xl mx-auto px-4 py-8" x-data="{ showModal: false }">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8 fade-in">
    <div>
      <h2
        class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-indigo-400"
      >
        منشئ التدفقات
      </h2>
      <p class="text-slate-400 mt-1">صمم مسارات المحادثة التفاعلية بسهولة</p>
    </div>
    <button
      @click="showModal = true"
      class="btn-primary flex items-center gap-2"
    >
      <span>➕</span> تدفق جديد
    </button>
  </div>

  <!-- Flows Grid -->
  <div
    id="flows-list"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
  >
    {% include "_flow_rows.html" %}
  </div>

  <!-- Create Flow Modal -->
  <div
    x-show="showModal"
    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    style="display: none"
  >
    <div
      class="glass-card w-full max-w-md p-6 shadow-2xl transform transition-all"
      @click.away="showModal = false"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0 scale-95"
      x-transition:enter-end="opacity-100 scale-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100 scale-100"
      x-transition:leave-end="opacity-0 scale-95"
    >
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-white">إنشاء تدفق جديد</h3>
        <button
          @click="showModal = false"
          class="text-slate-400 hover:text-white transition-colors"
        >
          ✕
        </button>
      </div>

      <form
        hx-post="/ui/flows"
        hx-target="#flows-list"
        hx-swap="innerHTML"
        @submit="showModal = false"
      >
        <div class="mb-4">
          <label class="label">اسم التدفق</label>
          <input
            type="text"
            name="name"
            class="input-field"
            required
            placeholder="مثال: طلب بيتزا"
          />
        </div>

        <div class="mb-6">
          <label class="label">كلمة مفتاحية (اختياري)</label>
          <input
            type="text"
            name="trigger_keyword"
            class="input-field"
            placeholder="مثال: بيتزا"
          />
          <p class="text-xs text-slate-500 mt-1">
            الكلمة التي يبدأ بها المستخدم لتفعيل هذا التدفق
          </p>
        </div>

        <div class="flex justify-end gap-3">
          <button
            type="button"
            @click="showModal = false"
            class="btn-secondary"
          >
            إلغاء
          </button>
          <button type="submit" class="btn-primary">إنشاء</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
