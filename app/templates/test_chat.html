{% extends "base.html" %} {% block title %}ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø´Ø§Øª - RoboVAI{% endblock %}
{% block content %}
<div class="grid lg:grid-cols-2 gap-6">
  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø§Øª -->
  <div class="glass-card p-6">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-bold text-slate-50">ğŸ§ª ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø´Ø§Øª</h1>
        <p class="text-slate-400 text-sm mt-1">Ø§Ø®ØªØ¨Ø± Ø§Ù„Ø¨ÙˆØª Ù‚Ø¨Ù„ Ù†Ø´Ø±Ù‡ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
      </div>
    </div>

    <div class="mb-4">
      <label class="label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
      <select id="tenant_select" class="select-field">
        <option value="">-- Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ --</option>
        {% for tenant in tenants %}
        <option value="{{ tenant.api_key }}">{{ tenant.name }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
    <div
      class="bg-slate-900/80 rounded-2xl border border-slate-700 overflow-hidden"
    >
      <!-- Header -->
      <div
        class="bg-gradient-to-r from-cyan-600 to-indigo-600 p-4 flex items-center gap-3"
      >
        <div
          class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl"
        >
          ğŸ¤–
        </div>
        <div>
          <div class="font-semibold text-white">RoboVAI Bot</div>
          <div class="text-xs text-white/70">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</div>
        </div>
      </div>

      <!-- Messages -->
      <div id="chat-messages" class="h-96 overflow-y-auto p-4 space-y-4">
        <div class="flex justify-start">
          <div
            class="bg-slate-800 rounded-2xl rounded-tr-sm px-4 py-2 max-w-xs"
          >
            <p class="text-slate-200 text-sm">
              Ù…Ø±Ø­Ø¨Ø§Ù‹! ğŸ‘‹ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ
            </p>
          </div>
        </div>
      </div>

      <!-- Input -->
      <form id="chatForm" class="p-4 border-t border-slate-700 flex gap-2">
        <input type="hidden" id="tenant_api_key" name="tenant_api_key" />
        <input
          type="text"
          id="message"
          name="message"
          placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
          class="flex-1 px-4 py-3 rounded-xl bg-slate-800 border border-slate-600 text-slate-100 placeholder-slate-500 focus:border-cyan-500 focus:outline-none"
        />
        <button type="submit" class="btn-primary px-6">Ø¥Ø±Ø³Ø§Ù„</button>
      </form>
    </div>
  </div>

  <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØªØ¹Ù„ÙŠÙ…Ø§Øª -->
  <div class="space-y-6">
    <div class="glass-card p-6">
      <h3 class="font-semibold text-slate-50 mb-4">ğŸ“ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h3>
      <div class="space-y-3 text-sm text-slate-400">
        <p>1ï¸âƒ£ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</p>
        <p>2ï¸âƒ£ Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†Øµ</p>
        <p>3ï¸âƒ£ Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ Ø£Ùˆ Enter</p>
        <p>4ï¸âƒ£ Ø§Ù†ØªØ¸Ø± Ø±Ø¯ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠ</p>
      </div>
    </div>

    <div class="glass-card p-6">
      <h3 class="font-semibold text-slate-50 mb-4">ğŸ’¡ Ø£ÙÙƒØ§Ø± Ù„Ù„ØªØ¬Ø±Ø¨Ø©</h3>
      <div class="space-y-2">
        <button
          onclick="sendQuickMessage('Ù…Ø±Ø­Ø¨Ø§')"
          class="w-full text-right px-4 py-2 bg-slate-800/50 rounded-lg text-slate-300 hover:bg-slate-700 transition text-sm"
        >
          ğŸ‘‹ "Ù…Ø±Ø­Ø¨Ø§"
        </button>
        <button
          onclick="sendQuickMessage('Ù…Ø§ Ù‡ÙŠ Ø®Ø¯Ù…Ø§ØªÙƒÙ…ØŸ')"
          class="w-full text-right px-4 py-2 bg-slate-800/50 rounded-lg text-slate-300 hover:bg-slate-700 transition text-sm"
        >
          â“ "Ù…Ø§ Ù‡ÙŠ Ø®Ø¯Ù…Ø§ØªÙƒÙ…ØŸ"
        </button>
        <button
          onclick="sendQuickMessage('ÙƒÙŠÙ Ø£ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙƒÙ…ØŸ')"
          class="w-full text-right px-4 py-2 bg-slate-800/50 rounded-lg text-slate-300 hover:bg-slate-700 transition text-sm"
        >
          ğŸ“ "ÙƒÙŠÙ Ø£ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙƒÙ…ØŸ"
        </button>
        <button
          onclick="sendQuickMessage('Ù…Ø§ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŸ')"
          class="w-full text-right px-4 py-2 bg-slate-800/50 rounded-lg text-slate-300 hover:bg-slate-700 transition text-sm"
        >
          ğŸ’° "Ù…Ø§ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŸ"
        </button>
      </div>
    </div>

    <div
      class="glass-card p-6 bg-gradient-to-br from-green-900/20 to-green-900/5 border-green-700/50"
    >
      <h3 class="font-semibold text-green-300 mb-2">âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø´Ø±ØŸ</h3>
      <p class="text-sm text-slate-400 mb-4">
        Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ø¨ÙˆØª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¨Ø·Ù‡ Ø¨Ù‚Ù†ÙˆØ§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø£Ùˆ Ø¥Ø¶Ø§ÙØ©
        Ø§Ù„ÙˆÙŠØ¯Ø¬Øª Ù„Ù…ÙˆÙ‚Ø¹Ùƒ.
      </p>
      <div class="flex gap-2">
        <a href="/ui/channels" class="btn-secondary text-sm">ğŸ“± Ø±Ø¨Ø· Ø§Ù„Ù‚Ù†ÙˆØ§Øª</a>
        <a href="/ui/widget" class="btn-primary text-sm">ğŸ”Œ Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙŠØ¯Ø¬Øª</a>
      </div>
    </div>
  </div>
</div>

<script>
  document
    .getElementById('tenant_select')
    .addEventListener('change', function () {
      document.getElementById('tenant_api_key').value = this.value;
    });

  document
    .getElementById('chatForm')
    .addEventListener('submit', async function (e) {
      e.preventDefault();

      const apiKey = document.getElementById('tenant_api_key').value;
      const messageInput = document.getElementById('message');
      const message = messageInput.value.trim();

      if (!apiKey) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø´Ø±ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹');
        return;
      }

      if (!message) return;

      // Add user message
      const chatMessages = document.getElementById('chat-messages');
      chatMessages.innerHTML += `
        <div class="flex justify-end">
            <div class="bg-gradient-to-r from-cyan-600 to-indigo-600 rounded-2xl rounded-tl-sm px-4 py-2 max-w-xs">
                <p class="text-white text-sm">${message}</p>
            </div>
        </div>
    `;

      messageInput.value = '';
      chatMessages.scrollTop = chatMessages.scrollHeight;

      // Show typing indicator
      const typingId = 'typing-' + Date.now();
      chatMessages.innerHTML += `
        <div id="${typingId}" class="flex justify-start">
            <div class="bg-slate-800 rounded-2xl rounded-tr-sm px-4 py-2">
                <p class="text-slate-400 text-sm">ÙŠÙƒØªØ¨...</p>
            </div>
        </div>
    `;
      chatMessages.scrollTop = chatMessages.scrollHeight;

      // Send to server
      const formData = new FormData();
      formData.append('tenant_api_key', apiKey);
      formData.append('message', message);

      try {
        const response = await fetch('/ui/test-chat/send', {
          method: 'POST',
          body: formData,
        });

        // Remove typing indicator
        document.getElementById(typingId)?.remove();

        const html = await response.text();
        chatMessages.innerHTML += html;
        chatMessages.scrollTop = chatMessages.scrollHeight;
      } catch (error) {
        document.getElementById(typingId)?.remove();
        chatMessages.innerHTML += `
            <div class="flex justify-start">
                <div class="bg-red-900/50 border border-red-700 rounded-2xl rounded-tr-sm px-4 py-2">
                    <p class="text-red-300 text-sm">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</p>
                </div>
            </div>
        `;
      }
    });

  function sendQuickMessage(text) {
    document.getElementById('message').value = text;
    document.getElementById('chatForm').dispatchEvent(new Event('submit'));
  }
</script>
{% endblock %}
