{% extends "base.html" %}
{% block title %}Ø§Ù„Ù‚Ù†ÙˆØ§Øª - RoboVAI{% endblock %}
{% block content %}
<div class="grid lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 glass-card p-6">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h1 class="text-2xl font-bold text-slate-50">ğŸ“± Ù‚Ù†ÙˆØ§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h1>
                <p class="text-slate-400 text-sm mt-1">Ø§Ø±Ø¨Ø· Ø§Ù„Ø¨ÙˆØª Ù…Ø¹ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…ØŒ ÙˆØ§ØªØ³Ø§Ø¨ØŒ Ù…Ø§Ø³Ù†Ø¬Ø± ÙˆØ¥Ù†Ø³ØªØ¬Ø±Ø§Ù…</p>
            </div>
        </div>

        <div class="mb-6">
            <label class="label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
            <select id="tenant_select" class="select-field" onchange="loadChannels()">
                <option value="">-- Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ --</option>
                {% for tenant in tenants %}
                <option value="{{ tenant.api_key }}">{{ tenant.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div id="channel-rows">
            <div class="text-center py-12 text-slate-400">
                <div class="text-5xl mb-4">ğŸ“±</div>
                <p>Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…ØªØµÙ„Ø©</p>
            </div>
        </div>
    </div>

    <div class="glass-card p-6">
        <h2 class="text-xl font-bold text-slate-50 mb-4">â• Ø¥Ø¶Ø§ÙØ© Ù‚Ù†Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
        
        <form id="channelForm" class="space-y-4">
            <input type="hidden" id="tenant_api_key" name="tenant_api_key" />
            
            <div>
                <label class="label">Ù†ÙˆØ¹ Ø§Ù„Ù‚Ù†Ø§Ø©</label>
                <select id="channel_type" name="channel_type" required class="select-field">
                    <option value="telegram">ğŸ¤– ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…</option>
                    <option value="whatsapp">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</option>
                    <option value="messenger">ğŸ’™ Ù…Ø§Ø³Ù†Ø¬Ø± ÙÙŠØ³Ø¨ÙˆÙƒ</option>
                    <option value="instagram">ğŸ“¸ Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…</option>
                </select>
            </div>

            <div>
                <label class="label">Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù‚Ù†Ø§Ø©</label>
                <input type="text" id="external_id" name="external_id" placeholder="Bot ID / Page ID" class="input-field" />
            </div>

            <div>
                <label class="label">Access Token</label>
                <input type="password" id="access_token" name="access_token" placeholder="ØªÙˆÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„" class="input-field" />
            </div>

            <button type="submit" class="btn-primary w-full">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù†Ø§Ø©</button>
        </form>

        <div class="mt-6 p-4 bg-blue-900/20 border border-blue-700/50 rounded-xl">
            <h3 class="font-semibold text-blue-300 mb-2">ğŸ’¡ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø±Ø¨Ø·</h3>
            <div class="text-sm text-slate-400 space-y-2">
                <p><strong>ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…:</strong> @BotFather</p>
                <p><strong>ÙˆØ§ØªØ³Ø§Ø¨:</strong> Meta Business API</p>
                <p><strong>Ù…Ø§Ø³Ù†Ø¬Ø±:</strong> Facebook Developer</p>
                <p><strong>Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…:</strong> Instagram Graph API</p>
            </div>
        </div>
    </div>
</div>

<script>
function loadChannels() {
    const apiKey = document.getElementById('tenant_select').value;
    document.getElementById('tenant_api_key').value = apiKey;
    if (apiKey) {
        htmx.ajax('GET', '/ui/channels/rows?tenant_api_key=' + encodeURIComponent(apiKey), {target: '#channel-rows'});
    }
}

document.getElementById('channelForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const apiKey = document.getElementById('tenant_api_key').value;
    if (!apiKey) { alert('Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹'); return; }
    
    const formData = new FormData(this);
    formData.set('is_active', 'true');
    
    const response = await fetch('/ui/channels', { method: 'POST', body: formData });
    if (response.ok) {
        document.getElementById('channel-rows').innerHTML = await response.text();
        this.reset();
        document.getElementById('tenant_api_key').value = apiKey;
        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ“');
    }
});
</script>
{% endblock %}
