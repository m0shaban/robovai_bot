{% if tenant %}
<div class="grid lg:grid-cols-2 gap-6">
    <!-- AI & Bot Settings -->
    <div class="space-y-6">
        <!-- AI Status Card -->
        <div class="glass-card p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-slate-50">๐ค ุญุงูุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู</h3>
                {% if ai_configured %}
                <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    ูุชุตู
                </span>
                {% else %}
                <span class="px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-red-500"></span>
                    ุบูุฑ ููุนุฏ
                </span>
                {% endif %}
            </div>
            
            <div class="space-y-3 text-sm">
                <div class="flex justify-between items-center p-3 bg-slate-800/50 rounded-lg">
                    <span class="text-slate-400">ุงููุฒูุฏ</span>
                    <span class="text-cyan-400 font-medium">{{ ai_provider }}</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-slate-800/50 rounded-lg">
                    <span class="text-slate-400">ุงููููุฐุฌ</span>
                    <span class="text-indigo-400 font-medium">{{ ai_model }}</span>
                </div>
                {% if not ai_configured %}
                <div class="p-4 bg-yellow-900/20 border border-yellow-700/50 rounded-xl">
                    <p class="text-yellow-300 text-sm mb-2">โ๏ธ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุบูุฑ ููุนุฏ!</p>
                    <p class="text-yellow-400/80 text-xs">ูุฌุจ ุฅุถุงูุฉ <code class="bg-slate-800 px-1 rounded">GROQ_API_KEY</code> ุฃู <code class="bg-slate-800 px-1 rounded">LLM_API_KEY</code> ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุนูู Render</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- System Prompt -->
        <div class="glass-card p-6">
            <h3 class="text-lg font-semibold text-slate-50 mb-4">๐ง ุดุฎุตูุฉ ุงูุจูุช (System Prompt)</h3>
            <form id="promptForm" onsubmit="saveSettings(event)">
                <input type="hidden" name="tenant_api_key" value="{{ tenant.api_key }}" />
                <textarea name="system_prompt" rows="6" class="input-field mb-4" placeholder="ุฃูุช ูุณุงุนุฏ ุฐูู ูุฏูุฏ ุชุณุงุนุฏ ุงูุนููุงุก...">{{ tenant.system_prompt or '' }}</textarea>
                <p class="text-xs text-slate-500 mb-4">ูุญุฏุฏ ููู ูุชุตุฑู ุงูุจูุช ููุฌูุจ ุนูู ุงูุฃุณุฆูุฉ</p>
                
                <!-- Quick Prompts -->
                <div class="mb-4">
                    <p class="text-xs text-slate-400 mb-2">ููุงูุจ ุฌุงูุฒุฉ:</p>
                    <div class="flex flex-wrap gap-2">
                        <button type="button" onclick="setPrompt('customer_service')" class="px-3 py-1 text-xs bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors">
                            ๐ ุฎุฏูุฉ ุนููุงุก
                        </button>
                        <button type="button" onclick="setPrompt('sales')" class="px-3 py-1 text-xs bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors">
                            ๐ผ ูุจูุนุงุช
                        </button>
                        <button type="button" onclick="setPrompt('support')" class="px-3 py-1 text-xs bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors">
                            ๐ง ุฏุนู ููู
                        </button>
                        <button type="button" onclick="setPrompt('friendly')" class="px-3 py-1 text-xs bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors">
                            ๐ ูุฏูุฏ
                        </button>
                    </div>
                </div>

                <button type="submit" class="btn-primary w-full">๐พ ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
            </form>
        </div>
    </div>

    <!-- Webhooks & API -->
    <div class="space-y-6">
        <!-- Webhook URLs -->
        <div class="glass-card p-6">
            <h3 class="text-lg font-semibold text-slate-50 mb-4">๐ ุฑูุงุจุท Webhook</h3>
            <p class="text-sm text-slate-400 mb-4">ุงุณุชุฎุฏู ูุฐู ุงูุฑูุงุจุท ูุฑุจุท ูููุงุช ุงูุชูุงุตู</p>
            
            <div class="space-y-4">
                <!-- Main Webhook -->
                <div>
                    <label class="text-xs text-slate-400 block mb-1">๐ก Webhook ุงูุฑุฆูุณู (ูุฌููุน ุงููููุงุช)</label>
                    <div class="flex gap-2">
                        <input type="text" readonly value="{{ base_url }}/api/webhooks/unified?api_key={{ tenant.api_key }}" 
                            class="input-field text-xs flex-1 bg-slate-900" id="main-webhook" />
                        <button onclick="copyToClipboard(document.getElementById('main-webhook').value, this)" 
                            class="px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-xl transition-colors text-sm">
                            ๐ ูุณุฎ
                        </button>
                    </div>
                </div>

                <!-- Telegram Webhook -->
                <div>
                    <label class="text-xs text-slate-400 block mb-1">๐ฑ Telegram Webhook</label>
                    <div class="flex gap-2">
                        <input type="text" readonly value="{{ base_url }}/api/webhooks/telegram/{{ tenant.api_key }}" 
                            class="input-field text-xs flex-1 bg-slate-900" id="telegram-webhook" />
                        <button onclick="copyToClipboard(document.getElementById('telegram-webhook').value, this)" 
                            class="px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-xl transition-colors text-sm">
                            ๐ ูุณุฎ
                        </button>
                    </div>
                </div>

                <!-- Meta Webhook -->
                <div>
                    <label class="text-xs text-slate-400 block mb-1">๐ฌ Meta (WhatsApp/Messenger/Instagram)</label>
                    <div class="flex gap-2">
                        <input type="text" readonly value="{{ base_url }}/api/webhooks/meta/{{ tenant.api_key }}" 
                            class="input-field text-xs flex-1 bg-slate-900" id="meta-webhook" />
                        <button onclick="copyToClipboard(document.getElementById('meta-webhook').value, this)" 
                            class="px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-xl transition-colors text-sm">
                            ๐ ูุณุฎ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Key -->
        <div class="glass-card p-6">
            <h3 class="text-lg font-semibold text-slate-50 mb-4">๐ API Key</h3>
            <div class="p-4 bg-slate-800/50 rounded-xl mb-4">
                <div class="flex items-center justify-between gap-2">
                    <code class="text-cyan-400 text-sm break-all" id="api-key-display">{{ tenant.api_key }}</code>
                    <button onclick="copyToClipboard('{{ tenant.api_key }}', this)" 
                        class="px-3 py-1 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg transition-colors text-xs flex-shrink-0">
                        ๐
                    </button>
                </div>
            </div>
            <p class="text-xs text-slate-500">ุงุณุชุฎุฏู ูุฐุง ุงูููุชุงุญ ูููุตูู ุฅูู API ุงูุฎุงุต ุจูุดุฑูุนู</p>
        </div>

        <!-- External Webhook -->
        <div class="glass-card p-6">
            <h3 class="text-lg font-semibold text-slate-50 mb-4">๐ค Webhook ุฎุงุฑุฌู (ุงุฎุชูุงุฑู)</h3>
            <form id="webhookForm" onsubmit="saveWebhook(event)">
                <input type="hidden" name="tenant_api_key" value="{{ tenant.api_key }}" />
                <input type="url" name="webhook_url" value="{{ tenant.webhook_url or '' }}" 
                    placeholder="https://your-server.com/webhook" class="input-field mb-2" />
                <p class="text-xs text-slate-500 mb-4">ุณูุชู ุฅุฑุณุงู ูุณุฎุฉ ูู ูู ุฑุณุงูุฉ ููุฐุง ุงูุนููุงู</p>
                <button type="submit" class="btn-secondary w-full">๐พ ุญูุธ</button>
            </form>
        </div>
    </div>
</div>

<!-- Quick Setup Guide -->
<div class="glass-card p-6 mt-6">
    <h3 class="text-lg font-semibold text-slate-50 mb-4">๐ ุฏููู ุงูุฅุนุฏุงุฏ ุงูุณุฑูุน</h3>
    <div class="grid md:grid-cols-3 gap-4">
        <div class="p-4 bg-slate-800/50 rounded-xl">
            <div class="text-2xl mb-2">1๏ธโฃ</div>
            <h4 class="font-medium text-slate-200 mb-1">ุงุญุตู ุนูู API Key</h4>
            <p class="text-xs text-slate-400">ุณุฌู ูู <a href="https://console.groq.com" target="_blank" class="text-cyan-400 hover:underline">Groq</a> ุฃู <a href="https://build.nvidia.com" target="_blank" class="text-cyan-400 hover:underline">NVIDIA</a></p>
        </div>
        <div class="p-4 bg-slate-800/50 rounded-xl">
            <div class="text-2xl mb-2">2๏ธโฃ</div>
            <h4 class="font-medium text-slate-200 mb-1">ุฃุถู ุงูููุชุงุญ</h4>
            <p class="text-xs text-slate-400">ูู Render: Environment โ Add <code class="bg-slate-900 px-1 rounded">GROQ_API_KEY</code></p>
        </div>
        <div class="p-4 bg-slate-800/50 rounded-xl">
            <div class="text-2xl mb-2">3๏ธโฃ</div>
            <h4 class="font-medium text-slate-200 mb-1">ุงุฑุจุท ุงููููุงุช</h4>
            <p class="text-xs text-slate-400">ุงูุณุฎ Webhook URL ูุฃุถูู ูู Telegram/Meta</p>
        </div>
    </div>
</div>

<script>
const prompts = {
    customer_service: `ุฃูุช ูุณุงุนุฏ ุฎุฏูุฉ ุนููุงุก ูุญุชุฑู ููุฏูุฏ. 
- ุฃุฌุจ ุจุดูู ูุฎุชุตุฑ ููููุฏ
- ูู ุตุจูุฑุงู ููุชูููุงู
- ุฅุฐุง ูู ุชุนุฑู ุงูุฅุฌุงุจุฉุ ุงุนุชุฐุฑ ูุงุทูุจ ุงูุชูุงุตู ูุน ูุฑูู ุงูุฏุนู
- ุงุณุชุฎุฏู ุงููุบุฉ ุงูุนุฑุจูุฉ ุงููุตุญู ุงููุจุณุทุฉ`,

    sales: `ุฃูุช ูุณุงุนุฏ ูุจูุนุงุช ูุญุชุฑู ููููุน.
- ุงุนุฑุถ ุงูููุชุฌุงุช ุจุดูู ุฌุฐุงุจ
- ุฃุฌุจ ุนูู ุงุณุชูุณุงุฑุงุช ุงูุฃุณุนุงุฑ ูุงูุนุฑูุถ
- ุดุฌุน ุงูุนููู ุนูู ุงูุดุฑุงุก ุจูุทู
- ูุฏู ุฎูุงุฑุงุช ูุชุนุฏุฏุฉ ุนูุฏ ุงูุฅููุงู`,

    support: `ุฃูุช ูููุฏุณ ุฏุนู ููู ูุญุชุฑู.
- ุงุทูุจ ุชูุงุตูู ุงููุดููุฉ ุจูุถูุญ
- ูุฏู ุญูููุงู ุฎุทูุฉ ุจุฎุทูุฉ
- ุฅุฐุง ูุงูุช ุงููุดููุฉ ูุนูุฏุฉุ ุงุทูุจ ุฑูู ุงูุชูุงุตู
- ูู ุชูููุงู ููู ุจุฃุณููุจ ููููู`,

    friendly: `ุฃูุช ูุณุงุนุฏ ูุฏูุฏ ููุทูู! ๐
- ุงุณุชุฎุฏู ุงูุฅูููุฌู ุจุดูู ูุนุชุฏู
- ูู ูุฑุญุงู ููู ูุญุชุฑูุงู
- ุฃุฌุจ ุจุดูู ูุตูุฑ ููุจุงุดุฑ
- ุงุณุฃู ุนู ุญุงู ุงูุนููู`
};

function setPrompt(type) {
    document.querySelector('textarea[name="system_prompt"]').value = prompts[type];
}

async function saveSettings(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    
    try {
        const response = await fetch('/ui/settings/update', {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            showToast('โ ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ');
        } else {
            showToast('โ ุญุฏุซ ุฎุทุฃ', 'error');
        }
    } catch (error) {
        showToast('โ ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู', 'error');
    }
}

async function saveWebhook(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    
    try {
        const response = await fetch('/ui/settings/update', {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            showToast('โ ุชู ุญูุธ Webhook');
        }
    } catch (error) {
        showToast('โ ุญุฏุซ ุฎุทุฃ', 'error');
    }
}
</script>

{% else %}
<div class="text-center py-12 text-slate-400">
    <div class="text-5xl mb-4">โ๏ธ</div>
    <p>ุงุฎุชุฑ ูุดุฑูุนุงู ูุนุฑุถ ุงูุฅุนุฏุงุฏุงุช</p>
</div>
{% endif %}
